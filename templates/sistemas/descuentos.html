{% extends 'index.html' %}
{% block contenido %}
<div class="container">
    <h1>Descuentos — QR asignados</h1>

    <section>
        <h2>Listado con QR por descuento</h2>
        {% if desc_list %}
        <div class="grid-cards">
            {% for entry in desc_list %}
            {% with d=entry.obj %}
            <div class="card" style="display:flex;align-items:center;gap:12px;">
                <div style="flex:1;">
                    <strong>{{ d.codigo }}</strong><br>
                    {{ d.porcentaje }}% — {{ d.vigencia|default:"(sin fecha)" }}
                </div>
                <div style="text-align:center;">
                    <img src="{{ entry.qr_img }}" alt="QR {{ d.codigo }}" style="width:120px;height:120px;">
                <div style="font-size:12px;margin-top:6px;">
                    <a href="{{ entry.qr_img }}" download="qr_desc_{{ d.pk }}.png">Descargar</a>
                </div>
            </div>
            {% endwith %}
            {% endfor %}
        </div>
        {% else %}
        <p>No hay descuentos.</p>
        {% endif %}
    </section>

    <section class="registro-card">
        <h2>Generar QR ad-hoc (Descuento)</h2>
            <form method="post" class="registro-form">
            {% csrf_token %}
            <label>Código:
                <input name="code" type="text" required>
            </label>
            <label>Porcentaje:
                <input name="percent" type="number" min="0" max="100" required>
            </label>
            <label>Expiración:
                <input name="expires" type="date">
            </label>
            <button type="submit" class="registro-button">Generar QR</button>
        </form>

        {% if qr_img_custom %}
        <h3>QR generado</h3>
        <img src="{{ qr_img_custom }}" alt="QR generado" style="width:160px;height:160px;">
        <p><a href="{{ qr_img_custom }}" download="qr_desc_custom.png">Descargar PNG</a></p>
        <h4>Contenido (JSON)</h4>
        <pre>{{ payload_custom|default:""|safe }}</pre>
        {% endif %}
    </section>
</div>
{% endblock contenido %}